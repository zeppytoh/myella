---
// Assets
import { Image } from "astro:assets";
// Fundations
import BaseLayout from "@/layouts/BaseLayout.astro";
import Text from "@/components/fundations/elements/Text.astro";
import Wrapper from "@/components/fundations/containers/Wrapper.astro";
// Components
import ShareButtons from "@/components/fundations/elements/ShareButtons.astro";
import BlogEntry from "@/components/blog/BlogEntry.astro";
// Content
const { frontmatter } = Astro.props;
import { getEntry } from "astro:content";
const team = await getEntry("team", frontmatter.team);
// Get all posts and filter by tag
import { getCollection } from "astro:content";
const allPosts = await getCollection("posts");
const relatedPosts = allPosts.filter((post) =>
  post.data.tags.some((tag) => frontmatter.tags.includes(tag))
);
---
<BaseLayout>
  <section>
    <Wrapper variant="standard" class="py-32">
      <div
        class="flex flex-col justify-between max-w-xl mx-auto text-center text-balance"
      >
        <div>
          <Text
            tag="h1"
            variant="displaySM"
            class="font-medium tracking-tight text-base-900"
          >
            {frontmatter.title}
          </Text>
          <Text
            tag="p"
            variant="textBase"
            class="mt-4 text-black "
          >
            {frontmatter.description}
          </Text>
        </div>
        <Image
          width={1000}
          height={800}
          alt={frontmatter.image.alt}
          src={frontmatter.image.url}
          class="object-cover object-center mt-8 size-full max-h-96 lg:col-span-2 rounded-xl"
        />
      </div>
      <div class="max-w-xl mx-auto mt-12">
        <Wrapper variant="prose">
          <slot />
        </Wrapper>
        <div class="w-full mt-24">
          {
            team && (
              <div class="flex items-center gap-3 hover:opacity-80 transition ">
                <a href={`/team/${team.slug}`}>
                  {team?.data?.image?.url && (
                    <Image
                      width={100}
                      height={100}
                      src={team.data.image.url}
                      alt={team.data.image.alt}
                      class="inline-block object-cover object-center border border-2 border-black rounded-lg shadow shadow-black size-24"
                    />
                  )}
                </a>
                <Text tag="p" variant="textLG" class="text-black ">
                  <span class="">
                    Written in
                    <span class="font-medium ">
                      <time
                        datetime={new Date(frontmatter.pubDate).toISOString()}
                      >
                        {new Date(frontmatter.pubDate).toLocaleDateString(
                          "en-US",
                          {
                            year: "numeric",
                            month: "long",
                            day: "2-digit",
                          }
                        )}
                      </time>
                    </span>
                  </span>
                  <span class="">
                    by
                    <span class="font-medium ">
                      {team.data.name}
                    </span>
                  </span>
                  <span class="block">
                    {team.data.role}
                    in
                    {frontmatter.tags.map((tag) => (
                      <>
                        <a href={`/blog/tags/${tag}`} class="capitalize ">
                          {tag}
                        </a>
                      </>
                    ))}
                  </span>
                </Text>
              </div>
            )
          }
        </div>
        <div class="flex flex-col mt-12 gap-2">
          <Text tag="p" variant="textXL" class="text-black">
            Share this article:
          </Text>
          <ShareButtons description={frontmatter.description} />
        </div>
      </div>
    </Wrapper>
  </section>
  {
    relatedPosts.length > 0 && (
      <section>
        <Wrapper variant="standard" class="py-12 border-t-2 border-black bg-yellow">
          <Text
            tag="h2"
            variant="displayMD"
            class="font-medium tracking-tight  text-base-900"
          >
            Related posts
          </Text>
          <div class="mt-4 grid grid-cols-1 gap-8 md:grid-cols-2 lg:grid-cols-3">
            {relatedPosts.slice(0, 3).map((post) => (
              <BlogEntry post={post} />
            ))}
          </div>
        </Wrapper>
      </section>
    )
  }
</BaseLayout>
